#! /bin/sh

# Prepare a freshly checked out copy of
# the CVS tree for compilation.

AMFLAGS=

if [ "$1" = "-a" ]
then
    ../../gnulib/gnulib/gnulib-tool --import fsusage getopt idcache strcase mbsstr memmove fnmatch fnmatch-gnu rename readlink putenv xalloc ; echo -n .
#    gnulib-tool --update; echo -n .
#    patch -p0 < lib-Makefile.am.patch ; echo -n .
    AMFLAGS="--add-missing --force-missing --copy"
fi

cp .gitignore .gitignore.gnulib-backup
rm -rf autom4te.cache config.cache; echo -n "."
#libtoolize --automake --copy --force && echo -n "."
autoheader && echo -n "."
aclocal -I m4 && echo -n "." &&
automake --foreign $AMFLAGS && echo -n "." &&
autoconf && echo -n "." &&
rm -rf autom4te.cache config.cache {lib,m4}/.gitignore ; echo -n "."
mv .gitignore.gnulib-backup .gitignore
echo " done"
